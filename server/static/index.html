<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RedTetris</title>
    <!-- <link type="text/css" ref="stylesheet" href="/css/index.css"/> -->
    <style>
      .container {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr;
      }
      .box {
        width: 100px;
        height: 100px;
        border: 1px solid black;
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <input id="input" type="text" />
    <button id="button">send</button>
    <button id="exit">exit</button>
    <div class="container"></div>
    <!-- <script
      src="https://cdn.socket.io/4.2.0/socket.io.min.js"
      integrity="sha384-PiBR5S00EtOj2Lto9Uu81cmoyZqR57XcOna1oAuVuIEjzj0wpqDVfD0JA9eXlRsj"
      crossorigin="anonymous"
    ></script> -->
    <script>
      const MOVE_UP = 1
      const MOVE_DOWN = 2
      const MOVE_LEFT = 3
      const MOVE_RIGHT = 4
      let d = {
        map: [
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0],
        ],
      }
      function render(data) {
        let div = ''
        if (Array.isArray(data.map)) {
          for (const line of data.map) for (const column of line) div += `<div class="box" ${column ? "style = 'background:#ff0000'" : ''}></div>`
        }
        document.getElementsByClassName('container')[0].innerHTML = div
      }
      render(d)
      const socket = io('http://localhost:3000', { withCredentials: true })
      socket.on('error', console.log)
      socket.on('handle error', (error) => console.log(error, 'OK'))
      socket.on('connect', () => {
        console.log(socket.id) // x8WIv7-mJelg7on_ALbx
      })
      socket.on('room created', (d) => console.log(d, 'room created'))
      document.getElementById('button').addEventListener('click', () => socket.emit('create room', { speed: 100 }))

      socket.on('piece info', (data) => {
        d = JSON.parse(data)
        console.log(d)
        render(d)
      })
    </script>
    <script src="/js/index.js"></script>
  </body>
</html>
